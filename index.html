<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tokyo Developers Map — Expanded v3</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  html, body, #map { height: 100%; margin:0; }
  .leaflet-popup-content { font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
</style>
</head>
<body>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const colorByCompany = {
    "Mori Building": "blue",
    "Tokyu": "red",
    "Mitsui Fudosan": "green",
    "Mitsubishi Estate": "purple",
    "Sumitomo Realty & Development": "orange",
    "Nomura Real Estate": "darkred",
    "Heiwa Real Estate": "darkgreen",
    "Tokyo Tatemono": "cadetblue",
    "Mori Trust": "black"
  };
  const layerGroups = {};
  Object.keys(colorByCompany).forEach(k => layerGroups[k] = L.layerGroup());

  const map = L.map('map').setView([35.68, 139.76], 12.5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  fetch('data/projects_v3.geojson')
    .then(r => r.json())
    .then(geojson => {
      L.geoJSON(geojson, {
        pointToLayer: function(feature, latlng) {
          const comp = feature.properties.Company;
          const color = colorByCompany[comp] || 'gray';
          return L.circleMarker(latlng, {
            radius: 7,
            fillColor: color,
            color: '#222',
            weight: 1,
            opacity: 1,
            fillOpacity: 0.95
          });
        },
        onEachFeature: function(feature, layer) {
          const p = feature.properties;
          const html = `
            <b>${p["프로젝트"]}</b> / <i>${p["Project"]}</i><br>
            <b>Company</b>: ${p["회사"]} / ${p["Company"]}<br>
            <b>Year</b>: ${p["Year"]}<br>
            <b>Type</b>: ${p["Type"]}<br>
            <b>GFA</b>: ${p["GFA"]} ㎡<br>
            <b>Floors</b>: ${p["Floors"]}<br>
            <b>Public Benefit</b>: ${p["Public Benefit"]}
          `;
          layer.bindPopup(html);
          const comp = p.Company;
          if (!layerGroups[comp]) layerGroups[comp] = L.layerGroup();
          layerGroups[comp].addLayer(layer);
        }
      });

      const overlays = {};
      Object.keys(layerGroups).forEach(k => {
        layerGroups[k].addTo(map);
        overlays[k] = layerGroups[k];
      });
      L.control.layers(null, overlays, { collapsed:false, position:'topright' }).addTo(map);
    });
</script>
</body>
</html>